:root {
  --bg: #f7f8fa;
  --panel-bg: #fff;
  --border: #e6e8eb;
  --text: #222;
  --muted: #7a7f87;
  --brand-primary: #2f6dfb;
  --brand-accent: #8694ff;
  --success: #16a34a;
  --warning: #f59e0b;
  --danger: #ef4444;
}

html, body {
  height: 100%;
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Microsoft YaHei';
  background: var(--bg);
  color: var(--text);
}

#app {
  display: grid;
  grid-template-columns: 320px 1fr 420px;
  height: calc(100% - 48px);
}

.header {
  height: 48px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 12px 0 16px;
  background: linear-gradient(90deg, #f6f8ff, #eef2ff);
  border-bottom: 1px solid var(--border);
}
.brand { display:flex; align-items:center; gap:8px; font-weight:600; color:#3a49a4; }
.brand i { font-size: 18px; }
.toolbar { display:flex; gap:8px; align-items:center; }
.toolbar select { height: 28px; padding: 2px 8px; border: 1px solid #d5d8dd; border-radius: 6px; background: #fff; }
.toolbar input[type=number] { height:28px; padding: 2px 6px; border:1px solid #d5d8dd; border-radius:6px; width:70px; }

.sidebar {
  padding: 12px;
  border-right: 1px solid var(--border);
  overflow: auto;
  position: relative;
  z-index: 3;
  background: var(--panel-bg);
}

.canvas {
  position: relative;
  z-index: 1;
  background: linear-gradient(180deg, #fbfcff, #f4f6fb);
}

.logs {
  padding: 12px;
  border-left: 1px solid var(--border);
  overflow: auto;
  background: var(--panel-bg);
}
/* 状态条 */
.status { margin: 0 0 8px 0; padding: 6px 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 12px; background: #fff; display:flex; align-items:center; gap:6px; }
.status.running { background: #f6f8ff; border-color: #c6d0ff; }
.status.failed { background:#fff5f5; border-color:#fecaca; color:#b91c1c; }
.status.ok { background:#f0fdf4; border-color:#bbf7d0; color:#166534; }
.spin { animation: spin 1s linear infinite; display:inline-block; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
[data-theme='dark'] .status { background:#0f172a; border-color:#263047; }
[data-theme='dark'] .status.running { background:#111b37; border-color:#3a4a7a; }
/* 指标卡片 */
.cards { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:8px; margin-bottom:8px; }
.card { padding:10px 12px; background:#fff; border:1px solid #e6e8eb; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }
.card .k { font-size:12px; color:#7a7f87; }
.card .v { font-size:18px; font-weight:700; color:#2f3a8a; }
[data-theme='dark'] .card { background:#0f172a; border-color:#263047; }
[data-theme='dark'] .card .k { color:#9aa3b2; }
[data-theme='dark'] .card .v { color:#c6d0ff; }

label { display:block; margin-top: 8px; font-size: 12px; color: #666; }
input { width: 100%; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; }
.buttons { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
button, .btn { padding: 8px 12px; border: 1px solid #d5d8dd; background: #fff; border-radius: 12px; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.03); transition: box-shadow .15s ease, transform .05s ease, background .15s ease, border-color .15s ease; }
button:hover { background: #f6f8ff; border-color: #c6d0ff; box-shadow: 0 6px 14px rgba(47,109,251,0.12); }
button:active { transform: translateY(1px); }
.btn-primary { color:#fff; background: var(--brand-primary); border-color: var(--brand-primary); }
.btn-primary:hover { background: color-mix(in oklab, var(--brand-primary) 88%, white); border-color: color-mix(in oklab, var(--brand-primary) 88%, white); box-shadow: 0 10px 22px color-mix(in oklab, var(--brand-primary) 30%, transparent); }
.btn-ghost { background: transparent; border-color: #d5d8dd; }
.btn-ghost:hover { background: #f6f8ff; border-color:#c6d0ff; }
.btn-danger { color:#fff; background: var(--danger); border-color: var(--danger); }
.btn-danger:hover { background: color-mix(in oklab, var(--danger) 88%, white); border-color: color-mix(in oklab, var(--danger) 88%, white); }
pre { white-space: pre-wrap; font-size: 12px; line-height:1.5; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#0b1020; color:#e6edf3; padding:10px; border-radius:10px; border:1px solid #10162d; }
.summary { margin-top: 12px; font-size: 12px; background: #fafafa; border: 1px solid var(--border); padding: 8px; border-radius: 6px; }

/* 节点面板（n8n 风格） */
.node-palette { margin: 6px 0 8px 0; border: 1px dashed var(--border); padding: 8px; border-radius: 8px; background: #fcfdff; }
.palette-title { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
.palette-list { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.palette-item { font-size: 12px; padding: 8px 10px; border: 1px solid #dfe3ea; border-radius: 10px; background: #fff; cursor: grab; user-select: none; transition: box-shadow .18s ease, transform .06s ease; display:flex; align-items:center; gap:6px; }
.palette-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.palette-item:active { cursor: grabbing; transform: scale(0.98); }

/* React Flow 画布尺寸与手势 */
.react-flow { width: 100%; height: 100%; }
.react-flow__pane { cursor: grab; }
.react-flow__pane:active { cursor: grabbing; }
.react-flow__background { background-color: rgba(134,148,255,0.04) !important; }

/* 自定义节点样式 */
.am-node {
  min-width: 180px;
  background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(247,250,255,0.96));
  border: 1px solid rgba(223,227,234,0.8);
  border-radius: 14px;
  box-shadow: 0 12px 28px rgba(40,60,120,0.12);
  overflow: hidden;
  transition: box-shadow .2s ease, transform .06s ease;
  backdrop-filter: blur(6px);
}
.am-node .header { display:flex; align-items:center; gap:6px; padding:8px 10px; background: linear-gradient(90deg, #eef3ff, #f7f9ff); border-bottom: 1px solid #e8ecf5; height:auto; }
.am-node .header .title { font-size: 12px; font-weight:700; color:#2f3a8a; display:flex; align-items:center; gap:6px; letter-spacing:.2px; }
.am-node .header .badge { margin-left:auto; font-size:10px; color:#546; background:#eef3ff; border:1px solid #dbe3ff; padding:2px 6px; border-radius:999px; }
.am-node .body { padding:8px 10px; font-size:12px; color:#333; }
.am-node .body .kv { display:flex; justify-content:space-between; gap:6px; }
.am-node .body .kv span { color:#6b7280; }
.am-node .footer { padding:6px 10px; background:#fafbff; border-top:1px solid #edf1fb; font-size:11px; color:#667; }
.am-node .actions { margin-top:6px; display:flex; gap:6px; }
.am-node .actions .mini { padding:4px 6px; font-size:11px; border-radius:6px; border:1px solid #d5d8dd; background:#fff; cursor:pointer; }
.am-node .actions .mini:hover { background:#f6f8ff; border-color:#c6d0ff; }
.am-node:hover { box-shadow: 0 10px 28px rgba(47,109,251,0.18); }

/* 暗色主题 */
[data-theme='dark'] {
  --bg: #0e1116; --panel-bg: #141923; --border: #1f2634; --text: #e5e7eb; --muted: #9aa3b2;
}
[data-theme='dark'] .header { background: linear-gradient(90deg, #121826, #111827); border-bottom-color: var(--border); }
[data-theme='dark'] .canvas { background: linear-gradient(180deg, #0f1623, #0d1421); }
[data-theme='dark'] .node-palette { background: #0f1623; border-color: var(--border); }
[data-theme='dark'] .palette-item { background: #0f172a; border-color: #263047; }
[data-theme='dark'] .summary { background: #0f1623; }
[data-theme='dark'] button { background:#0f172a; border-color:#2a3550; color:#dbe4ff; }
[data-theme='dark'] button:hover { background:#0e1b3a; border-color:#3a4a7a; }
[data-theme='dark'] .am-node { background: linear-gradient(180deg, #101625, #0f172a); border-color:#263047; }
[data-theme='dark'] .am-node .header { background: linear-gradient(90deg, #151c2e, #101828); border-bottom-color:#263047; }
[data-theme='dark'] .am-node .header .title { color:#dbe4ff; }
[data-theme='dark'] .am-node .header .badge { background:#1a2340; border-color:#32406b; color:#c6d0ff; }
[data-theme='dark'] .am-node .body { color:#d1d5db; }
[data-theme='dark'] .am-node .footer { background:#0f1623; border-top-color:#263047; color:#9aa3b2; }
[data-theme='dark'] .am-node .actions .mini { background:#0f172a; border-color:#2a3550; color:#dbe4ff; }
[data-theme='dark'] .am-node .actions .mini:hover { background:#0e1b3a; border-color:#3a4a7a; }

/* panels & headings */
.panel { background: #fff; border:1px solid var(--border); border-radius: 12px; padding: 8px; box-shadow: 0 6px 12px rgba(0,0,0,0.04); }
[data-theme='dark'] .panel { background:#0f172a; border-color:#263047; }
.sidebar h3, .sidebar h4 { margin: 10px 0 6px 0; color:#1f2937; letter-spacing:.2px }
[data-theme='dark'] .sidebar h3, [data-theme='dark'] .sidebar h4 { color:#e5e7eb; }

/* nicer scrollbars */
* { scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent; }
*::-webkit-scrollbar { width: 10px; height: 10px; }
*::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #d9e4ff, #c0c8ff); border-radius: 999px; }
*::-webkit-scrollbar-track { background: transparent; }

/* tags for flow steps */
.tag { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; border:1px solid #e6e8eb; background:#fff; font-size:12px; margin:4px 6px 0 0; }
.tag-ok { background:#f0fdf4; border-color:#bbf7d0; color:#166534; }
.tag-failed { background:#fff5f5; border-color:#fecaca; color:#b91c1c; }
.tag-running { background:#f6f8ff; border-color:#c6d0ff; color:#2f3a8a; }
[data-theme='dark'] .tag { background:#0f172a; border-color:#263047; }
[data-theme='dark'] .tag-ok { background:#0c1f14; border-color:#1f3b2a; color:#86efac; }
[data-theme='dark'] .tag-failed { background:#2a1313; border-color:#3f1a1a; color:#fecaca; }
[data-theme='dark'] .tag-running { background:#111b37; border-color:#3a4a7a; color:#c6d0ff; }

/* 品牌主题 */
[data-brand='ocean'] { --brand-primary:#2f6dfb; --brand-accent:#8694ff; }
[data-brand='forest'] { --brand-primary:#18a957; --brand-accent:#64d39b; }
[data-brand='sunset'] { --brand-primary:#ff6b6b; --brand-accent:#f7a778; }
.brand { color: var(--brand-primary); }
button:hover { box-shadow: 0 6px 14px color-mix(in oklab, var(--brand-primary) 25%, transparent); }
.am-node:hover { box-shadow: 0 12px 28px color-mix(in oklab, var(--brand-primary) 22%, transparent); }

/* 右键菜单 */
.ctx-menu {
  position: fixed; z-index: 1000;
  min-width: 160px; background: #fff; border: 1px solid #e6e8eb; border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.1); padding: 6px;
}
.ctx-menu .item { padding: 8px 10px; font-size: 12px; border-radius: 6px; cursor: pointer; }
.ctx-menu .item:hover { background: #f5f7ff; }
.ctx-menu .sep { height: 1px; background: #eef1f6; margin: 6px 0; }
[data-theme='dark'] .ctx-menu { background:#0f172a; border-color:#263047; box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
[data-theme='dark'] .ctx-menu .item:hover { background:#111b37; }

/* card grid for gallery */
.card-grid { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; }
.mini-card { border:1px solid #e6e8eb; border-radius:12px; background:#fff; padding:10px 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.04); }
.mini-card .title { font-size:12px; color:#334155; font-weight:700; margin-bottom:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.mini-card .row { display:flex; justify-content:space-between; font-size:12px; color:#475569; margin-top:2px; }
.mini-bar { height:6px; border-radius:999px; background: #eef2ff; overflow:hidden; margin-top:8px; }
.mini-bar > i { display:block; height:100%; background: linear-gradient(90deg, #86efac, #22c55e); border-radius:999px; }
[data-theme='dark'] .mini-card { background:#0f172a; border-color:#263047; }
[data-theme='dark'] .mini-card .title { color:#e5e7eb; }
[data-theme='dark'] .mini-card .row { color:#9aa3b2; }
[data-theme='dark'] .mini-bar { background:#1f2937; }
